{
  config,
  lib,
  pkgs,
  ...
}:
let
  inherit (lib) mkEnableOption mkIf;
in
{
  imports = [
    ./hyprland-conf.nix
    ./hyprlock.nix
  ];

  options.features.wm.hyprland.enable = mkEnableOption "Enable Hyprland window manager";

  config = mkIf config.features.wm.hyprland.enable {
    # Enable Hyprland
    wayland.windowManager.hyprland = {
      enable = true;
      xwayland.enable = true;
      systemd.enable = true;

      # Enable plugins
      plugins = [
        pkgs.hyprlandPlugins.hyprscrolling
      ];

      extraConfig = ''
        # Source monitor and workspace configs generated by nwg-displays
        source = ~/.config/hypr/monitors.conf
        source = ~/.config/hypr/workspaces.conf
      '';
    };

    features.application = {
      rofi.enable = true;
      waybar.enable = true;
      wlogout.enable = true;
      swaync.enable = true;
    };

    # Import Hyprland configuration

    # Essential Hyprland packages
    home.packages = with pkgs; [
      # Wayland essentials
      wayland
      wayland-protocols
      wayland-utils

      # Hyprland ecosystem
      nwg-displays

      # Wallpaper
      swww

      # Screenshot
      grim
      slurp
      grimblast

      # Media control
      playerctl

      # Audio control
      wireplumber
      pavucontrol

      # Brightness control
      brightnessctl

      # Auto-mounting
      udiskie

      # Image viewer
      nsxiv

      # Clipboard manager (optional)
      wl-clipboard
      cliphist
    ];

    # Services
    services = {
      # Auto-mounting
      udiskie = {
        enable = true;
        automount = true;
        notify = true;
        tray = "auto";
      };
    };
  };
}
